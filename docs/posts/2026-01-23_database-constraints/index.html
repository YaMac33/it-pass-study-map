<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- GEN: META -->
  <title>データベース制約の基本 - IT passport study map</title>
  <meta name="description" content="データベースの一意性制約と参照制約の違いを解説。重複禁止と参照整合性の概念を図解で整理し、試験で頻出のひっかけポイントもカバーします。" />
  <meta name="robots" content="index,follow" />

  <!-- Optional: OGP -->
  <meta property="og:type" content="article" />
  <meta property="og:title" content="データベース制約の基本" />
  <meta property="og:description" content="データベースの一意性制約と参照制約の違いを解説。重複禁止と参照整合性の概念を図解で整理し、試験で頻出のひっかけポイントもカバーします。" />
  
  <!-- Assets: 記事は docs/posts/<id>/index.html → ../../ 固定 -->
  <link rel="stylesheet" href="../../assets/styles.css" />

  <!-- GEN: EXTRA_CSS（図解・補助CSS） -->
  <style>
    /* 共通図解コンテナ */
    .diagram-section {
      background-color: #f9f9f9;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 2rem;
      margin: 2rem 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
    }

    /* テーブル表現 */
    .db-table-wrapper {
      background: #fff;
      border: 1px solid #333;
      border-radius: 4px;
      box-shadow: 3px 3px 0 rgba(0,0,0,0.1);
      overflow: hidden;
      font-size: 0.9rem;
      min-width: 200px;
    }
    .db-table-name {
      background: #333;
      color: #fff;
      padding: 4px 8px;
      font-weight: bold;
      font-size: 0.8rem;
      text-align: center;
    }
    .db-table {
      width: 100%;
      border-collapse: collapse;
    }
    .db-table th, .db-table td {
      border: 1px solid #ccc;
      padding: 6px 10px;
      text-align: center;
    }
    .db-table th {
      background: #eee;
      font-weight: bold;
      border-bottom: 2px solid #666;
    }
    .row-error {
      background-color: #ffebeb;
      position: relative;
    }
    .row-error td {
      color: #d00;
      text-decoration: line-through;
    }
    .error-badge {
      position: absolute;
      right: -10px;
      top: 50%;
      transform: translateY(-50%) translateX(100%);
      background: #d00;
      color: #fff;
      font-size: 0.75rem;
      padding: 2px 6px;
      border-radius: 4px;
      white-space: nowrap;
      font-weight: bold;
      text-decoration: none !important;
    }

    /* 参照関係の矢印 */
    .relation-arrow {
      color: #333;
      font-size: 1.5rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 1rem;
    }

    /* 比較表 */
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      font-size: 0.95rem;
    }
    .comparison-table th, .comparison-table td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    .comparison-table th {
      background-color: #f4f4f4;
      width: 25%;
    }
    .comparison-table td:nth-child(2) {
      background-color: #fffaf0; /* 一意性 */
    }
    .comparison-table td:nth-child(3) {
      background-color: #f0f8ff; /* 参照 */
    }

    /* ポイント強調 */
    .key-point {
      background-color: #f4f4f4;
      border-left: 4px solid #333;
      padding: 1rem;
      margin: 1.5rem 0;
    }
    .key-point strong {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 1.1em;
    }
    
    /* レスポンシブ */
    @media (max-width: 600px) {
      .diagram-section {
        padding: 1rem;
      }
      .relation-container {
        flex-direction: column;
      }
      .relation-arrow {
        transform: rotate(90deg);
        margin: 1rem 0;
      }
      .error-badge {
        position: static;
        display: block;
        transform: none;
        width: fit-content;
        margin-top: 2px;
        text-decoration: none;
      }
      .row-error td {
        text-decoration: none;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header class="site-header">
      <a href="../../index.html" class="site-title">IT passport study map</a>
      <nav class="site-nav">
        <ul>
          <li><a href="../../index.html">Back to List</a></li>
        </ul>
      </nav>
    </header>

    <main>
      <article class="article-content">
        <header class="article-header">
          <!-- GEN: POST_META -->
          <time class="post-meta" datetime="2026-01-23">
            2026.01.23 / テクノロジ系
          </time>

          <!-- GEN: TITLE -->
          <h1 class="article-title">データベース制約の基本</h1>

          <!-- GEN: TAGS -->
          <ul class="tag-list">
            <li class="tag">#データベース</li>
            <li class="tag">#制約</li>
            <li class="tag">#一意性</li>
            <li class="tag">#参照制約</li>
            <li class="tag">#SQL</li>
          </ul>
        </header>

        <!-- GEN: BODY -->
        <p>データベースの信頼性を保つために不可欠な「制約」。<br>
        特に試験で頻出する「一意性制約」と「参照制約」は、言葉は似ていますが役割が明確に異なります。</p>
        <p>まず結論から言ってしまうと、違いは以下の1行で説明できます。</p>
        
        <div class="key-point" style="text-align:center;">
          <strong>一意性制約 ＝ 同じ値を入れさせない<br>
          参照制約 ＝ 存在しない値を入れさせない</strong>
        </div>

        <h2>1. 一意性制約（UNIQUE制約）</h2>
        <p>一意性制約は、列の値が<strong>「重複しない」</strong>ことを保証する制約です。<br>
        社員番号、メールアドレス、ログインIDなど、「他人のものと被ってはいけない」データに使われます。</p>

        <div class="diagram-section">
          <div class="db-table-wrapper">
            <div class="db-table-name">ユーザ表</div>
            <table class="db-table">
              <thead>
                <tr>
                  <th>ID (PK)</th>
                  <th>Email (UNIQUE)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td>a@example.com</td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>b@example.com</td>
                </tr>
                <tr class="row-error">
                  <td>3</td>
                  <td>a@example.com</td>
                  <!-- CSSでエラーバッジ表示 -->
                </tr>
              </tbody>
            </table>
          </div>
          <p style="color:#d00; font-weight:bold; font-size:0.9rem;">
            ❌ エラー： "a@example.com" は既に存在するため登録不可
          </p>
        </div>

        <p><strong>ポイント：</strong> 他のテーブルは関係ありません。そのテーブルの中だけでチェックが完結します。</p>

        <h2>2. 参照制約（外部キー制約）</h2>
        <p>参照制約は、列の値が<strong>「関連する別の表に存在している」</strong>ことを保証する制約です。<br>
        「存在しない部門ID」や「存在しない商品ID」が登録されてしまう、いわゆるデータの「迷子」や「幽霊」を防ぎます。</p>

        <div class="diagram-section">
          <div style="display:flex; align-items:center; flex-wrap:wrap; justify-content:center;" class="relation-container">
            <!-- 親テーブル -->
            <div class="db-table-wrapper">
              <div class="db-table-name">親：部門表</div>
              <table class="db-table">
                <thead>
                  <tr>
                    <th>部門ID (PK)</th>
                    <th>部門名</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td>10</td><td>営業</td></tr>
                  <tr><td>20</td><td>開発</td></tr>
                  <tr><td>30</td><td>人事</td></tr>
                </tbody>
              </table>
            </div>

            <div class="relation-arrow">← 参照</div>

            <!-- 子テーブル -->
            <div class="db-table-wrapper">
              <div class="db-table-name">子：社員表</div>
              <table class="db-table">
                <thead>
                  <tr>
                    <th>社員ID</th>
                    <th>部門ID (FK)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr><td>1</td><td>10 (OK)</td></tr>
                  <tr><td>2</td><td>20 (OK)</td></tr>
                  <tr class="row-error">
                    <td>3</td>
                    <td>40</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <p style="color:#d00; font-weight:bold; font-size:0.9rem;">
            ❌ エラー： 部門ID "40" は親テーブルに存在しない
          </p>
        </div>

        <p><strong>ポイント：</strong> テーブルとテーブルの間の整合性を守ります。親テーブルにある値しか使えません。</p>

        <h2>3. 違いの比較まとめ</h2>
        <p>試験で問われるポイントを表にまとめました。</p>

        <table class="comparison-table">
          <thead>
            <tr>
              <th>項目</th>
              <th>一意性制約</th>
              <th>参照制約</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>守るもの</strong></td>
              <td>重複しないこと<br>（ダブり禁止）</td>
              <td>存在していること<br>（幽霊禁止）</td>
            </tr>
            <tr>
              <td><strong>対象</strong></td>
              <td>1つの表内で完結</td>
              <td>複数の表（親子関係）</td>
            </tr>
            <tr>
              <td><strong>主な用途</strong></td>
              <td>ID、メアド、コード管理</td>
              <td>売上データと商品マスタ等の紐付け</td>
            </tr>
          </tbody>
        </table>

        <h2>4. 試験対策：よく出る重要ポイント</h2>

        <h3>主キー（Primary Key）との関係</h3>
        <p>主キー制約は、実は「合わせ技」です。</p>
        <div class="key-point">
            <strong>主キー（PK） ＝ 一意性制約 ＋ NOT NULL制約</strong>
        </div>
        <p>つまり、「一意性制約」単体であれば、NULL（空の値）を許可することがあります（データベース製品の実装によりますが、一般的にNULL同士は重複とみなされません）。一方、主キーはNULLも重複も許されません。</p>

        <h3>参照制約の「削除ルール」</h3>
        <p>参照制約がある場合、<strong>「使われている親データ」は勝手に削除できません。</strong><br>
        例えば、社員が所属している「営業部（ID:10）」を部門表から消そうとするとエラーになります。</p>
        <p>これを回避するための追加設定（CASCADE等）も試験に出ることがありますが、まずは基本の「子供がいる親は消せない」を覚えておきましょう。</p>

        <h3>よくあるひっかけ</h3>
        <ul>
            <li>❌ <strong>誤解：</strong>「参照制約があると、同じ部門IDを複数の社員に登録できない」<br>
            → <strong>⭕ 正解：</strong>それはOKです。参照制約は「存在確認」だけを行います。重複を禁止したいなら一意性制約が必要です。</li>
        </ul>

        <h2>まとめ</h2>
        <ul>
            <li><strong>一意性制約：</strong>「ダブり禁止」</li>
            <li><strong>参照制約：</strong>「幽霊禁止（存在しない値禁止）」</li>
        </ul>
        <p>SQLのエラーメッセージや、データベース設計の問題が出たときは、この原則を思い出してください。</p>

        <!-- GEN: REFERENCES -->
      </article>
    </main>

    <footer class="site-footer">
      <p>&copy; <span id="year"></span> IT passport study map. All rights reserved.</p>
    </footer>
  </div>

  <!-- GEN: EXTRA_JS -->
  <script>
    // 共通：年表示
    const y = document.getElementById('year');
    if (y) y.textContent = new Date().getFullYear();
  </script>
</body>
</html>